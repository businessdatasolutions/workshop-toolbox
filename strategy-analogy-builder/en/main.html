<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Strategy Analogy Builder</title>
    <!-- Materialize CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      /* Base Layout */
      body {
        display: flex;
        min-height: 100vh;
        flex-direction: column;
      }
      main {
        flex: 1 0 auto;
        padding: 20px 0;
      }
      /* Card Panels and General Spacing */
      .card-panel {
        margin-bottom: 20px;
      }
      /* Tabs Styling */
      .tabs .tab a {
        color: #26a69a;
      }
      .tabs .tab a:hover,
      .tabs .tab a.active {
        color: #00796b;
      }
      .tabs .indicator {
        background-color: #00796b;
      }
      /* Navigation and Export Options */
      .step-navigation {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
      }
      /* Premise Layout */
      .premise-row {
        display: flex;
        margin-bottom: 10px;
      }
      .premise-row .input-field {
        flex-grow: 1;
        margin: 0 10px;
      }
      .premise-label {
        display: flex;
        align-items: center;
        width: 100px;
      }
      .premise-relation {
        width: 150px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Hidden Element */
      .hidden {
        display: none;
      }
      /* Summary Table */
      .summary-table {
        margin: 20px 0;
      }
      .summary-table th,
      .summary-table td {
        padding: 10px;
      }
      /* Feature Type Select */
      .feature-type {
        width: 120px;
      }
      /* Help Modal */
      #help-modal {
        max-width: 700px;
      }
      .help-content {
        padding: 0 20px 20px 20px;
      }
      .help-content h5 {
        margin-top: 30px;
      }
      /* Premise Container */
      .premise-container {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .premise-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      /* Export Options */
      .export-options {
        display: flex;
        justify-content: center;
        margin: 20px 0;
        gap: 20px;
      }
      /* Brand Logo */
      .brand-logo {
        margin-left: 15px;
      }
      /* Section Title */
      .section-title {
        margin-bottom: 20px;
      }
      /* Chip */
      .chip {
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <nav class="teal darken-1">
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">Strategy Analogy Builder</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li>
            <a href="#" data-target="help-modal" class="modal-trigger"
              ><i class="material-icons left">help_outline</i>Help</a
            >
          </li>
          <li>
            <a href="#" id="reset-btn"
              ><i class="material-icons left">refresh</i>Reset</a
            >
          </li>
          <li>
            <a href="#" id="export-btn"
              ><i class="material-icons left">file_download</i>Export</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main>
      <div class="container">
        <!-- Progress Steps -->
        <div class="row">
          <div class="col s12">
            <ul class="tabs">
              <li class="tab col s3">
                <a href="#step1" class="active">1. Define Target</a>
              </li>
              <li class="tab col s3"><a href="#step2">2. Select Source</a></li>
              <li class="tab col s3"><a href="#step3">3. Build Analogy</a></li>
              <li class="tab col s3"><a href="#step4">4. Evaluate</a></li>
            </ul>
          </div>
        </div>

        <!-- Step 1: Define Target -->
        <div id="step1" class="col s12">
          <div class="card-panel">
            <h5 class="section-title">Step 1: Define Your Target</h5>
            <p>
              Start by defining your target company or startup (the one you're
              working on the strategy for).
            </p>
            <div class="row">
              <div class="input-field col s12">
                <input id="target-name" type="text" class="validate" />
                <label for="target-name">Target Company/Startup Name</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <textarea
                  id="target-description"
                  class="materialize-textarea"
                ></textarea>
                <label for="target-description"
                  >Brief Description (products, market, customers)</label
                >
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input
                  id="target-desired-outcome"
                  type="text"
                  class="validate"
                />
                <label for="target-desired-outcome"
                  >Desired Strategic Outcome (e.g., market success, growth, cost
                  leadership)</label
                >
              </div>
            </div>
          </div>
          <div class="step-navigation">
            <div></div>
            <a class="waves-effect waves-light btn next-step" data-next="step2">
              <i class="material-icons right">arrow_forward</i>Next
            </a>
          </div>
        </div>

        <!-- Step 2: Select Source -->
        <div id="step2" class="col s12">
          <div class="card-panel">
            <h5 class="section-title">Step 2: Select Your Source</h5>
            <p>
              Select a source company or business that displays the outcome you
              want for your target. The source should be successful in
              demonstrating the conclusion you want to achieve.
            </p>
            <div class="row">
              <div class="input-field col s12">
                <input id="source-name" type="text" class="validate" />
                <label for="source-name">Source Company Name</label>
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <textarea
                  id="source-description"
                  class="materialize-textarea"
                ></textarea>
                <label for="source-description"
                  >Why did you select this company? What makes it
                  successful?</label
                >
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input id="source-outcome" type="text" class="validate" />
                <label for="source-outcome"
                  >Source's Strategic Outcome (e.g., market success, cost
                  leadership)</label
                >
              </div>
            </div>
          </div>
          <div class="step-navigation">
            <a class="waves-effect waves-light btn prev-step" data-prev="step1">
              <i class="material-icons left">arrow_back</i>Previous
            </a>
            <a class="waves-effect waves-light btn next-step" data-next="step3">
              <i class="material-icons right">arrow_forward</i>Next
            </a>
          </div>
        </div>

        <!-- Step 3: Build Analogy -->
        <div id="step3" class="col s12">
          <div class="card-panel">
            <h5 class="section-title">Step 3: Build Your Analogy</h5>
            <p>
              Now, identify key similarities and differences between your source
              and target. These will form the premises of your analogy.
            </p>
            <div id="premise-container">
              <!-- Initial Premise -->
              <div class="premise-container">
                <div class="premise-header">
                  <h6>Premise A</h6>
                  <div>
                    <select class="feature-type browser-default">
                      <option value="positive" selected>
                        Positive (Similar)
                      </option>
                      <option value="negative">Negative (Different)</option>
                    </select>
                  </div>
                </div>
                <div class="premise-row">
                  <div class="premise-label">Source</div>
                  <div class="input-field">
                    <input type="text" class="source-feature validate" />
                  </div>
                </div>
                <div class="premise-row">
                  <div class="premise-relation">
                    <span class="relation-text">is similar to</span>
                  </div>
                </div>
                <div class="premise-row">
                  <div class="premise-label">Target</div>
                  <div class="input-field">
                    <input type="text" class="target-feature validate" />
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input type="text" class="causal-relevance validate" />
                    <label
                      >Causal Relevance (How does this feature contribute to
                      success?)</label
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="center-align">
              <a class="waves-effect waves-light btn" id="add-premise">
                <i class="material-icons left">add</i>Add Another Premise
              </a>
            </div>
          </div>

          <div class="card-panel">
            <h5>Conclusion</h5>
            <div class="premise-row">
              <div class="premise-label">Source</div>
              <div class="input-field">
                <input
                  type="text"
                  id="conclusion-source"
                  class="validate"
                  readonly
                />
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-relation">
                <span>is plausibly similar to</span>
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-label">Target</div>
              <div class="input-field">
                <input
                  type="text"
                  id="conclusion-target"
                  class="validate"
                  readonly
                />
              </div>
            </div>
          </div>

          <div class="step-navigation">
            <a class="waves-effect waves-light btn prev-step" data-prev="step2">
              <i class="material-icons left">arrow_back</i>Previous
            </a>
            <a class="waves-effect waves-light btn next-step" data-next="step4">
              <i class="material-icons right">arrow_forward</i>Next
            </a>
          </div>
        </div>

        <!-- Step 4: Evaluate -->
        <div id="step4" class="col s12">
          <div class="card-panel">
            <h5 class="section-title">Step 4: Evaluate Your Analogy</h5>
            <!-- Company Header -->
            <div class="row">
              <div class="col s12 center-align">
                <div
                  class="chip teal white-text"
                  style="
                    font-size: 16px;
                    padding: 0;
                    margin: 5px 10px;
                    height: 40px;
                    line-height: 40px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 120px;
                  "
                >
                  <span
                    id="header-source-name"
                    style="font-weight: bold; text-align: center; width: 100%"
                    >[Source]</span
                  >
                </div>
                <i
                  class="material-icons"
                  style="vertical-align: middle; margin: 0 10px"
                  >compare_arrows</i
                >
                <div
                  class="chip teal darken-1 white-text"
                  style="
                    font-size: 16px;
                    padding: 0;
                    margin: 5px 10px;
                    height: 40px;
                    line-height: 40px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 120px;
                  "
                >
                  <span
                    id="header-target-name"
                    style="font-weight: bold; text-align: center; width: 100%"
                    >[Target]</span
                  >
                </div>
              </div>
            </div>
            <p>
              Review your analogy to assess its strength. Focus on the causal
              relationships (vertical relations) and relevance of each premise.
            </p>
            <div class="row">
              <div class="col s12">
                <h6>Analogy Summary</h6>
                <table class="summary-table bordered">
                  <thead>
                    <tr>
                      <th width="10%">#</th>
                      <th width="35%">Source Feature</th>
                      <th width="20%">Relation</th>
                      <th width="35%">Target Feature</th>
                    </tr>
                  </thead>
                  <tbody id="summary-table-body">
                    <!-- Populated dynamically -->
                  </tbody>
                  <tfoot>
                    <tr>
                      <td>Conclusion</td>
                      <td id="summary-source-outcome"></td>
                      <td>is plausibly similar to</td>
                      <td id="summary-target-outcome"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
            <div class="row">
              <div class="col s12">
                <h6>Evaluation Questions</h6>
                <ul class="collection">
                  <li class="collection-item">
                    <p>
                      1. Do the positive similarities between
                      <span id="eval-source-name1"></span> and
                      <span id="eval-target-name1"></span> outweigh the negative
                      differences in terms of relevance to the outcome?
                    </p>
                    <div class="input-field">
                      <textarea
                        id="evaluation-1"
                        class="materialize-textarea"
                      ></textarea>
                    </div>
                  </li>
                  <li class="collection-item">
                    <p>
                      2. Are the vertical (causal) relations in
                      <span id="eval-source-name2"></span> strong? Do they
                      actually generate the successful outcome?
                    </p>
                    <div class="input-field">
                      <textarea
                        id="evaluation-2"
                        class="materialize-textarea"
                      ></textarea>
                    </div>
                  </li>
                  <li class="collection-item">
                    <p>
                      3. Can these same causal relations plausibly apply to
                      <span id="eval-target-name3"></span> as well?
                    </p>
                    <div class="input-field">
                      <textarea
                        id="evaluation-3"
                        class="materialize-textarea"
                      ></textarea>
                    </div>
                  </li>
                  <li class="collection-item">
                    <p>
                      4. Are there any crucial missing premises that would need
                      to be added to make
                      <span id="eval-target-name4"></span> successful?
                    </p>
                    <div class="input-field">
                      <textarea
                        id="evaluation-4"
                        class="materialize-textarea"
                      ></textarea>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <div class="row">
              <div class="col s12">
                <h6>Overall Assessment</h6>
                <div class="input-field">
                  <textarea
                    id="overall-assessment"
                    class="materialize-textarea"
                  ></textarea>
                  <label for="overall-assessment"
                    >What is your overall assessment of this strategy analogy
                    between <span id="eval-source-name5"></span> and
                    <span id="eval-target-name5"></span>?</label
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="export-options">
            <a
              class="waves-effect waves-light btn"
              id="export-pdf"
              onclick="exportAsPDF()"
            >
              <i class="material-icons left">picture_as_pdf</i>Export as PDF
            </a>
            <a
              class="waves-effect waves-light btn"
              id="export-txt"
              onclick="exportAsText()"
            >
              <i class="material-icons left">description</i>Export as Text
            </a>
          </div>
          <div class="step-navigation">
            <a class="waves-effect waves-light btn prev-step" data-prev="step3">
              <i class="material-icons left">arrow_back</i>Previous
            </a>
            <div></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="page-footer teal darken-1">
      <div class="container">
        <div class="row">
          <div class="col s12">
            <h5 class="white-text">Strategy Analogy Builder</h5>
            <p class="grey-text text-lighten-4">
              Based on the paper "Strategy Theory Using Analogy: Rationale,
              Tools and Examples" by Glenn R. Carroll and Jesper B. Sørensen
              (2024).
            </p>
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="container">© 2025 Strategy Analogy Builder</div>
      </div>
    </footer>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
      <div class="modal-content">
        <h4>Strategy Analogy Builder Guide</h4>
        <div class="help-content">
          <p>
            This tool helps you develop a strategy analogy following the
            methodology described by Carroll and Sørensen (2024). Here's how to
            use it:
          </p>
          <h5>Step 1: Define Your Target</h5>
          <p>
            Start by defining your target company - the organization you're
            developing a strategy for. Clearly state the desired strategic
            outcome (market success, cost leadership, etc.).
          </p>
          <h5>Step 2: Select Your Source</h5>
          <p>
            Choose a source company that displays the outcome you want to
            achieve. The source should be a successful example that demonstrates
            the conclusion you're aiming for.
          </p>
          <h5>Step 3: Build Your Analogy</h5>
          <p>
            Identify key similarities (positive premises) and differences
            (negative premises) between your source and target. For each
            premise:
          </p>
          <ul>
            <li>Describe the feature in both the source and target</li>
            <li>Indicate whether it's a similarity or difference</li>
            <li>Explain its causal relevance to the outcome</li>
          </ul>
          <p>
            Remember that the most important premises are those with strong
            causal relationships to the outcome.
          </p>
          <h5>Step 4: Evaluate Your Analogy</h5>
          <p>Assess the strength of your analogy by examining:</p>
          <ul>
            <li>
              Whether positive similarities outweigh negative differences in
              relevance
            </li>
            <li>The strength of vertical (causal) relations in the source</li>
            <li>
              Whether these causal relations can plausibly apply to the target
            </li>
            <li>Any missing premises needed for success</li>
          </ul>
          <h5>Key Concepts</h5>
          <p>
            <strong>Horizontal Relations</strong>: The one-to-one mappings of
            features between source and target.
          </p>
          <p>
            <strong>Vertical Relations</strong>: The causal relationships among
            features within the source and target.
          </p>
          <p>
            <strong>Positive Analogy</strong>: Features that are similar between
            source and target.
          </p>
          <p>
            <strong>Negative Analogy</strong>: Features that differ between
            source and target.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat"
          >Close</a
        >
      </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Refactored JavaScript with Full PDF Export -->
    <script>
      (function () {
        "use strict";

        let premiseCount = 1;

        // Helper: Refresh Materialize text fields
        const refreshTextFields = () => M.updateTextFields();

        // Debounce helper
        function debounce(func, wait) {
          let timeout;
          return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
          };
        }

        // Update relation text based on feature type selection
        function updateRelationText(event) {
          const select = event.target;
          const container = select.closest(".premise-container");
          const relationSpan = container.querySelector(".relation-text");
          relationSpan.textContent =
            select.value === "positive" ? "is similar to" : "is not similar to";
        }

        // Bind change event to feature type selects
        function bindFeatureTypeListeners() {
          document.querySelectorAll(".feature-type").forEach((select) => {
            select.removeEventListener("change", updateRelationText);
            select.addEventListener("change", updateRelationText);
          });
        }

        // Update Conclusion and Summary fields
        function updateConclusion() {
          const sourceOutcome = document.getElementById("source-outcome").value;
          const targetOutcome = document.getElementById(
            "target-desired-outcome"
          ).value;
          document.getElementById("conclusion-source").value = sourceOutcome;
          document.getElementById("conclusion-target").value = targetOutcome;
          document.getElementById("summary-source-outcome").textContent =
            sourceOutcome;
          document.getElementById("summary-target-outcome").textContent =
            targetOutcome;
          refreshTextFields();
        }

        // Update evaluation header company names
        function updateEvaluationCompanyNames() {
          const sourceName =
            document.getElementById("source-name").value || "[Source Company]";
          const targetName =
            document.getElementById("target-name").value || "[Target Company]";
          document.getElementById("header-source-name").textContent =
            sourceName;
          document.getElementById("header-target-name").textContent =
            targetName;
          [
            "eval-source-name1",
            "eval-source-name2",
            "eval-source-name5",
          ].forEach((id) => {
            document.getElementById(id).textContent = sourceName;
          });
          [
            "eval-target-name1",
            "eval-target-name3",
            "eval-target-name4",
            "eval-target-name5",
          ].forEach((id) => {
            document.getElementById(id).textContent = targetName;
          });
          refreshTextFields();
        }

        // Update Summary Table (Step 4)
        function updateSummaryTable() {
          const tableBody = document.getElementById("summary-table-body");
          tableBody.innerHTML = "";
          document
            .querySelectorAll(".premise-container")
            .forEach((premise, index) => {
              const letter = String.fromCharCode(65 + index);
              const sourceFeature =
                premise.querySelector(".source-feature").value;
              const targetFeature =
                premise.querySelector(".target-feature").value;
              const featureType = premise.querySelector(".feature-type").value;
              const relation =
                featureType === "positive"
                  ? "is similar to"
                  : "is not similar to";
              const row = document.createElement("tr");
              row.innerHTML = `<td>${letter}</td><td>${sourceFeature}</td><td>${relation}</td><td>${targetFeature}</td>`;
              tableBody.appendChild(row);
            });
        }

        // Update state when navigating tabs
        function updateState() {
          updateConclusion();
          if (M.Tabs.getInstance(document.querySelector(".tabs")).index === 3) {
            updateSummaryTable();
            updateEvaluationCompanyNames();
          }
        }

        // Add a new premise
        function addNewPremise() {
          premiseCount++;
          const nextLetter = String.fromCharCode(65 + premiseCount - 1);
          const newPremise = document.createElement("div");
          newPremise.className = "premise-container";
          newPremise.innerHTML = `
            <div class="premise-header">
              <h6>Premise ${nextLetter}</h6>
              <div>
                <select class="feature-type browser-default">
                  <option value="positive" selected>Positive (Similar)</option>
                  <option value="negative">Negative (Different)</option>
                </select>
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-label">Source</div>
              <div class="input-field">
                <input type="text" class="source-feature validate">
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-relation">
                <span class="relation-text">is similar to</span>
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-label">Target</div>
              <div class="input-field">
                <input type="text" class="target-feature validate">
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input type="text" class="causal-relevance validate">
                <label>Causal Relevance (How does this feature contribute to success?)</label>
              </div>
            </div>
          `;
          document.getElementById("premise-container").appendChild(newPremise);
          refreshTextFields();
          bindFeatureTypeListeners();
        }

        // Reset data and UI
        function resetData() {
          if (
            !confirm(
              "This will clear all your data. Are you sure you want to reset?"
            )
          )
            return;
          document
            .querySelectorAll("input, textarea")
            .forEach((input) => (input.value = ""));
          refreshTextFields();
          // Reset premise container to one initial premise
          const container = document.getElementById("premise-container");
          container.innerHTML = "";
          premiseCount = 1;
          const initialPremise = document.createElement("div");
          initialPremise.className = "premise-container";
          initialPremise.innerHTML = `
            <div class="premise-header">
              <h6>Premise A</h6>
              <div>
                <select class="feature-type browser-default">
                  <option value="positive" selected>Positive (Similar)</option>
                  <option value="negative">Negative (Different)</option>
                </select>
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-label">Source</div>
              <div class="input-field">
                <input type="text" class="source-feature validate">
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-relation">
                <span class="relation-text">is similar to</span>
              </div>
            </div>
            <div class="premise-row">
              <div class="premise-label">Target</div>
              <div class="input-field">
                <input type="text" class="target-feature validate">
              </div>
            </div>
            <div class="row">
              <div class="input-field col s12">
                <input type="text" class="causal-relevance validate">
                <label>Causal Relevance (How does this feature contribute to success?)</label>
              </div>
            </div>
          `;
          container.appendChild(initialPremise);
          M.Tabs.getInstance(document.querySelector(".tabs")).select("step1");
          refreshTextFields();
        }

        // Export as Text
        function exportAsText() {
          const targetName = document.getElementById("target-name").value;
          const targetDesc =
            document.getElementById("target-description").value;
          const targetOutcome = document.getElementById(
            "target-desired-outcome"
          ).value;
          const sourceName = document.getElementById("source-name").value;
          const sourceDesc =
            document.getElementById("source-description").value;
          const sourceOutcome = document.getElementById("source-outcome").value;
          let text = "STRATEGY ANALOGY ANALYSIS\n========================\n\n";
          text += "TARGET COMPANY:\n";
          text += `Name: ${targetName}\nDescription: ${targetDesc}\nDesired Outcome: ${targetOutcome}\n\n`;
          text += "SOURCE COMPANY:\n";
          text += `Name: ${sourceName}\nDescription: ${sourceDesc}\nOutcome: ${sourceOutcome}\n\n`;
          text += "ANALOGY PREMISES:\n";
          document
            .querySelectorAll(".premise-container")
            .forEach((premise, index) => {
              const letter = String.fromCharCode(65 + index);
              const sourceFeature =
                premise.querySelector(".source-feature").value;
              const targetFeature =
                premise.querySelector(".target-feature").value;
              const featureType = premise.querySelector(".feature-type").value;
              const causalRelevance =
                premise.querySelector(".causal-relevance").value;
              const relation =
                featureType === "positive"
                  ? "is similar to"
                  : "is not similar to";
              text += `Premise ${letter}:\n- Source: ${sourceFeature}\n- Relation: ${relation}\n- Target: ${targetFeature}\n- Causal Relevance: ${causalRelevance}\n\n`;
            });
          text += "CONCLUSION:\n";
          text += `${sourceOutcome} is plausibly similar to ${targetOutcome}\n\n`;
          text += "EVALUATION:\n";
          text += `1. Do positive similarities between ${sourceName} and ${targetName} outweigh negative differences? ${
            document.getElementById("evaluation-1").value
          }\n\n`;
          text += `2. Are vertical relations in ${sourceName} strong? ${
            document.getElementById("evaluation-2").value
          }\n\n`;
          text += `3. Can causal relations apply to ${targetName}? ${
            document.getElementById("evaluation-3").value
          }\n\n`;
          text += `4. Missing premises for ${targetName}? ${
            document.getElementById("evaluation-4").value
          }\n\n`;
          text +=
            "OVERALL ASSESSMENT:\n" +
            document.getElementById("overall-assessment").value;
          const blob = new Blob([text], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `${targetName}-Strategy-Analogy.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        // Export as PDF using jsPDF
        function exportAsPDF() {
          if (typeof window.jspdf === "undefined") {
            alert(
              "PDF library not loaded. Please try again or check your internet connection."
            );
            return;
          }
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Gather Data
          const targetName =
            document.getElementById("target-name").value || "(Unnamed Target)";
          const targetDesc =
            document.getElementById("target-description").value || "";
          const targetOutcome =
            document.getElementById("target-desired-outcome").value || "";
          const sourceName =
            document.getElementById("source-name").value || "(Unnamed Source)";
          const sourceDesc =
            document.getElementById("source-description").value || "";
          const sourceOutcome =
            document.getElementById("source-outcome").value || "";

          const premises = [];
          document
            .querySelectorAll(".premise-container")
            .forEach((premise, index) => {
              const letter = String.fromCharCode(65 + index);
              const sourceFeature =
                premise.querySelector(".source-feature").value || "";
              const targetFeature =
                premise.querySelector(".target-feature").value || "";
              const featureType = premise.querySelector(".feature-type").value;
              const causalRelevance =
                premise.querySelector(".causal-relevance").value || "";
              const relation =
                featureType === "positive"
                  ? "is similar to"
                  : "is not similar to";
              premises.push({
                letter,
                sourceFeature,
                relation,
                targetFeature,
                causalRelevance,
              });
            });

          const evaluations = {
            q1: document.getElementById("evaluation-1").value || "",
            q2: document.getElementById("evaluation-2").value || "",
            q3: document.getElementById("evaluation-3").value || "",
            q4: document.getElementById("evaluation-4").value || "",
            overall: document.getElementById("overall-assessment").value || "",
          };

          // PDF Styling Variables
          const margin = 20;
          let y = margin;

          // Helper: Add Wrapped Text
          function addWrappedText(text, x, y, maxWidth, lineHeight) {
            const lines = doc.splitTextToSize(text, maxWidth);
            doc.text(lines, x, y);
            return y + lines.length * lineHeight;
          }

          // Title
          doc.setFontSize(18);
          doc.setFont(undefined, "bold");
          doc.text(
            "STRATEGY ANALOGY ANALYSIS",
            doc.internal.pageSize.width / 2,
            y,
            { align: "center" }
          );
          y += 10;

          // Header: Source to Target
          doc.setFontSize(14);
          doc.text(
            `${sourceName} to ${targetName}`,
            doc.internal.pageSize.width / 2,
            y,
            { align: "center" }
          );
          y += 15;

          // Target Company Section
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("TARGET COMPANY", margin, y);
          y += 7;
          doc.setFontSize(10);
          doc.setFont(undefined, "bold");
          doc.text("Name:", margin, y);
          doc.setFont(undefined, "normal");
          doc.text(targetName, margin + 30, y);
          y += 6;
          doc.setFont(undefined, "bold");
          doc.text("Description:", margin, y);
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            targetDesc,
            margin + 30,
            y,
            doc.internal.pageSize.width - margin * 2 - 30,
            5
          );
          y += 6;
          doc.setFont(undefined, "bold");
          doc.text("Desired Outcome:", margin, y);
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            targetOutcome,
            margin + 30,
            y,
            doc.internal.pageSize.width - margin * 2 - 30,
            5
          );
          y += 10;

          // Source Company Section
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("SOURCE COMPANY", margin, y);
          y += 7;
          doc.setFontSize(10);
          doc.setFont(undefined, "bold");
          doc.text("Name:", margin, y);
          doc.setFont(undefined, "normal");
          doc.text(sourceName, margin + 30, y);
          y += 6;
          doc.setFont(undefined, "bold");
          doc.text("Description:", margin, y);
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            sourceDesc,
            margin + 30,
            y,
            doc.internal.pageSize.width - margin * 2 - 30,
            5
          );
          y += 6;
          doc.setFont(undefined, "bold");
          doc.text("Outcome:", margin, y);
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            sourceOutcome,
            margin + 30,
            y,
            doc.internal.pageSize.width - margin * 2 - 30,
            5
          );
          y += 10;

          // Premises Section
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("ANALOGY PREMISES", margin, y);
          y += 10;
          premises.forEach((premise) => {
            if (y > doc.internal.pageSize.height - 30) {
              doc.addPage();
              y = margin;
            }
            doc.setFontSize(12);
            doc.setFont(undefined, "bold");
            doc.text(
              `Premise ${premise.letter}: ${
                premise.relation.includes("similar")
                  ? "(Positive)"
                  : "(Negative)"
              }`,
              margin,
              y
            );
            y += 6;
            doc.setFontSize(10);
            doc.setFont(undefined, "bold");
            doc.text("Source:", margin, y);
            doc.setFont(undefined, "normal");
            y = addWrappedText(
              premise.sourceFeature,
              margin + 30,
              y,
              doc.internal.pageSize.width - margin * 2 - 30,
              5
            );
            y += 4;
            doc.setFont(undefined, "bold");
            doc.text("Relation:", margin, y);
            doc.setFont(undefined, "normal");
            doc.text(premise.relation, margin + 30, y);
            y += 4;
            doc.setFont(undefined, "bold");
            doc.text("Target:", margin, y);
            doc.setFont(undefined, "normal");
            y = addWrappedText(
              premise.targetFeature,
              margin + 30,
              y,
              doc.internal.pageSize.width - margin * 2 - 30,
              5
            );
            y += 4;
            doc.setFont(undefined, "bold");
            doc.text("Causal Relevance:", margin, y);
            doc.setFont(undefined, "normal");
            y = addWrappedText(
              premise.causalRelevance,
              margin + 30,
              y,
              doc.internal.pageSize.width - margin * 2 - 30,
              5
            );
            y += 8;
          });

          // Conclusion Section
          if (y > doc.internal.pageSize.height - 50) {
            doc.addPage();
            y = margin;
          }
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("CONCLUSION", margin, y);
          y += 7;
          doc.setFontSize(10);
          doc.setFont(undefined, "normal");
          doc.text(
            `${sourceOutcome} is plausibly similar to ${targetOutcome}`,
            margin,
            y
          );
          y += 10;

          // Evaluation Section
          if (y > doc.internal.pageSize.height - 100) {
            doc.addPage();
            y = margin;
          }
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("EVALUATION", margin, y);
          y += 10;
          doc.setFontSize(10);
          doc.setFont(undefined, "bold");
          doc.text(
            `1. Do the positive similarities between ${sourceName} and ${targetName} outweigh the negative differences?`,
            margin,
            y
          );
          y += 6;
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            evaluations.q1,
            margin,
            y,
            doc.internal.pageSize.width - margin * 2,
            5
          );
          y += 8;
          if (y > doc.internal.pageSize.height - 50) {
            doc.addPage();
            y = margin;
          }
          doc.setFont(undefined, "bold");
          doc.text(
            `2. Are the vertical (causal) relations in ${sourceName} strong?`,
            margin,
            y
          );
          y += 6;
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            evaluations.q2,
            margin,
            y,
            doc.internal.pageSize.width - margin * 2,
            5
          );
          y += 8;
          if (y > doc.internal.pageSize.height - 50) {
            doc.addPage();
            y = margin;
          }
          doc.setFont(undefined, "bold");
          doc.text(
            `3. Can these same causal relations plausibly apply to ${targetName} as well?`,
            margin,
            y
          );
          y += 6;
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            evaluations.q3,
            margin,
            y,
            doc.internal.pageSize.width - margin * 2,
            5
          );
          y += 8;
          if (y > doc.internal.pageSize.height - 50) {
            doc.addPage();
            y = margin;
          }
          doc.setFont(undefined, "bold");
          doc.text(
            `4. Are there any crucial missing premises that would need to be added to make ${targetName} successful?`,
            margin,
            y
          );
          y += 6;
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            evaluations.q4,
            margin,
            y,
            doc.internal.pageSize.width - margin * 2,
            5
          );
          y += 10;
          if (y > doc.internal.pageSize.height - 60) {
            doc.addPage();
            y = margin;
          }
          doc.setFontSize(14);
          doc.setFont(undefined, "bold");
          doc.text("OVERALL ASSESSMENT", margin, y);
          y += 7;
          doc.setFontSize(10);
          doc.setFont(undefined, "normal");
          y = addWrappedText(
            evaluations.overall,
            margin,
            y,
            doc.internal.pageSize.width - margin * 2,
            5
          );

          // Footer: Page Numbers
          const pageCount = doc.internal.getNumberOfPages();
          for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.text(
              `Strategy Analogy Analysis - Page ${i} of ${pageCount}`,
              doc.internal.pageSize.width / 2,
              doc.internal.pageSize.height - 10,
              { align: "center" }
            );
          }
          doc.save(`${targetName}-Strategy-Analogy.pdf`);
        }

        // Save to Local Storage
        function saveToLocalStorage() {
          const data = {
            target: {
              name: document.getElementById("target-name").value,
              description: document.getElementById("target-description").value,
              outcome: document.getElementById("target-desired-outcome").value,
            },
            source: {
              name: document.getElementById("source-name").value,
              description: document.getElementById("source-description").value,
              outcome: document.getElementById("source-outcome").value,
            },
            premises: Array.from(
              document.querySelectorAll(".premise-container")
            ).map((premise) => ({
              sourceFeature: premise.querySelector(".source-feature").value,
              targetFeature: premise.querySelector(".target-feature").value,
              featureType: premise.querySelector(".feature-type").value,
              causalRelevance: premise.querySelector(".causal-relevance").value,
            })),
            evaluation: {
              q1: document.getElementById("evaluation-1").value,
              q2: document.getElementById("evaluation-2").value,
              q3: document.getElementById("evaluation-3").value,
              q4: document.getElementById("evaluation-4").value,
              overall: document.getElementById("overall-assessment").value,
            },
          };
          localStorage.setItem("strategyAnalogy", JSON.stringify(data));
        }

        // Load from Local Storage
        function loadFromLocalStorage() {
          const savedData = localStorage.getItem("strategyAnalogy");
          if (savedData) {
            try {
              const data = JSON.parse(savedData);
              document.getElementById("target-name").value =
                data.target.name || "";
              document.getElementById("target-description").value =
                data.target.description || "";
              document.getElementById("target-desired-outcome").value =
                data.target.outcome || "";
              document.getElementById("source-name").value =
                data.source.name || "";
              document.getElementById("source-description").value =
                data.source.description || "";
              document.getElementById("source-outcome").value =
                data.source.outcome || "";
              if (data.premises && data.premises.length > 0) {
                const container = document.getElementById("premise-container");
                container.innerHTML = "";
                data.premises.forEach((pData, index) => {
                  premiseCount = index + 1;
                  const letter = String.fromCharCode(65 + index);
                  const premiseDiv = document.createElement("div");
                  premiseDiv.className = "premise-container";
                  premiseDiv.innerHTML = `
                    <div class="premise-header">
                      <h6>Premise ${letter}</h6>
                      <div>
                        <select class="feature-type browser-default">
                          <option value="positive" ${
                            pData.featureType === "positive" ? "selected" : ""
                          }>Positive (Similar)</option>
                          <option value="negative" ${
                            pData.featureType === "negative" ? "selected" : ""
                          }>Negative (Different)</option>
                        </select>
                      </div>
                    </div>
                    <div class="premise-row">
                      <div class="premise-label">Source</div>
                      <div class="input-field">
                        <input type="text" class="source-feature validate" value="${
                          pData.sourceFeature || ""
                        }">
                      </div>
                    </div>
                    <div class="premise-row">
                      <div class="premise-relation">
                        <span class="relation-text">${
                          pData.featureType === "positive"
                            ? "is similar to"
                            : "is not similar to"
                        }</span>
                      </div>
                    </div>
                    <div class="premise-row">
                      <div class="premise-label">Target</div>
                      <div class="input-field">
                        <input type="text" class="target-feature validate" value="${
                          pData.targetFeature || ""
                        }">
                      </div>
                    </div>
                    <div class="row">
                      <div class="input-field col s12">
                        <input type="text" class="causal-relevance validate" value="${
                          pData.causalRelevance || ""
                        }">
                        <label ${
                          pData.causalRelevance ? 'class="active"' : ""
                        }>Causal Relevance (How does this feature contribute to success?)</label>
                      </div>
                    </div>
                  `;
                  container.appendChild(premiseDiv);
                });
              }
              if (data.evaluation) {
                document.getElementById("evaluation-1").value =
                  data.evaluation.q1 || "";
                document.getElementById("evaluation-2").value =
                  data.evaluation.q2 || "";
                document.getElementById("evaluation-3").value =
                  data.evaluation.q3 || "";
                document.getElementById("evaluation-4").value =
                  data.evaluation.q4 || "";
                document.getElementById("overall-assessment").value =
                  data.evaluation.overall || "";
              }
              refreshTextFields();
              updateConclusion();
              return true;
            } catch (e) {
              console.error("Error loading saved data:", e);
              return false;
            }
          }
          return false;
        }

        // Load example data
        function loadExampleData() {
          document.getElementById("target-name").value = "Instacart";
          document.getElementById("target-description").value =
            "Grocery delivery platform connecting customers with personal shoppers who select and deliver groceries from local stores.";
          document.getElementById("target-desired-outcome").value =
            "Market growth and profitability";
          document.getElementById("source-name").value = "DoorDash";
          document.getElementById("source-description").value =
            "Food delivery platform that connects customers with restaurants and delivery drivers. Successfully expanded to other delivery categories.";
          document.getElementById("source-outcome").value =
            "Market growth and profitability";
          const container = document.getElementById("premise-container");
          container.innerHTML = "";
          const premises = [
            {
              letter: "A",
              sourceFeature:
                "On-demand platform connecting three sides of marketplace (restaurants, drivers, customers)",
              targetFeature:
                "On-demand platform connecting three sides of marketplace (stores, shoppers, customers)",
              featureType: "positive",
              causalRelevance:
                "Multi-sided platform creates network effects and high barriers to entry",
            },
            {
              letter: "B",
              sourceFeature:
                "Independent contractor workforce with flexible hours",
              targetFeature:
                "Independent contractor workforce with flexible hours",
              featureType: "positive",
              causalRelevance:
                "Enables scaling without fixed labor costs, can match supply with demand",
            },
            {
              letter: "C",
              sourceFeature:
                "Low-skill delivery task requiring minimal training",
              targetFeature:
                "Higher-skill shopping task requiring product selection and substitution judgment",
              featureType: "negative",
              causalRelevance:
                "Quality of service is harder to maintain, requires more training",
            },
            {
              letter: "D",
              sourceFeature: "Existing restaurant inventory management systems",
              targetFeature:
                "Minimal grocery store inventory management systems",
              featureType: "negative",
              causalRelevance:
                "Creates challenges for accurate product availability",
            },
          ];
          premises.forEach((premise, index) => {
            premiseCount = index + 1;
            const premiseDiv = document.createElement("div");
            premiseDiv.className = "premise-container";
            premiseDiv.innerHTML = `
              <div class="premise-header">
                <h6>Premise ${premise.letter}</h6>
                <div>
                  <select class="feature-type browser-default">
                    <option value="positive" ${
                      premise.featureType === "positive" ? "selected" : ""
                    }>Positive (Similar)</option>
                    <option value="negative" ${
                      premise.featureType === "negative" ? "selected" : ""
                    }>Negative (Different)</option>
                  </select>
                </div>
              </div>
              <div class="premise-row">
                <div class="premise-label">Source</div>
                <div class="input-field">
                  <input type="text" class="source-feature validate" value="${
                    premise.sourceFeature
                  }">
                </div>
              </div>
              <div class="premise-row">
                <div class="premise-relation">
                  <span class="relation-text">${
                    premise.featureType === "positive"
                      ? "is similar to"
                      : "is not similar to"
                  }</span>
                </div>
              </div>
              <div class="premise-row">
                <div class="premise-label">Target</div>
                <div class="input-field">
                  <input type="text" class="target-feature validate" value="${
                    premise.targetFeature
                  }">
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <input type="text" class="causal-relevance validate" value="${
                    premise.causalRelevance
                  }">
                  <label class="active">Causal Relevance (How does this feature contribute to success?)</label>
                </div>
              </div>
            `;
            container.appendChild(premiseDiv);
          });
          document.getElementById("evaluation-1").value =
            "The positive similarities related to the platform model and flexible workforce are highly relevant to the business model success. The negative differences in shopping skill requirements and inventory systems are significant but can potentially be addressed with technology.";
          document.getElementById("evaluation-2").value =
            "DoorDash's success is strongly tied to the network effects of its platform and its ability to scale with a flexible workforce. These causal mechanisms appear robust.";
          document.getElementById("evaluation-3").value =
            "The same network effect dynamics could apply to Instacart, though the higher complexity of grocery shopping compared to food delivery may reduce some efficiency.";
          document.getElementById("evaluation-4").value =
            "Instacart may need to add a stronger training and quality control system for shoppers given the higher skill requirements. Additionally, it should develop better inventory integration with grocery partners.";
          document.getElementById("overall-assessment").value =
            "The analogy between DoorDash and Instacart is strong in the platform business model fundamentals but requires additional premises to address the unique challenges of grocery shopping. With proper attention to the negative analogies, Instacart can likely achieve similar market success.";
          refreshTextFields();
          updateConclusion();
          saveToLocalStorage();
        }

        // Bind Event Listeners on DOMContentLoaded
        document.addEventListener("DOMContentLoaded", function () {
          M.Tabs.init(document.querySelectorAll(".tabs"));
          M.Modal.init(document.querySelectorAll(".modal"));
          document
            .querySelectorAll("textarea")
            .forEach((textarea) => M.textareaAutoResize(textarea));

          // Step Navigation
          document.querySelectorAll(".next-step").forEach((button) => {
            button.addEventListener("click", function () {
              const nextTab = this.getAttribute("data-next");
              M.Tabs.getInstance(document.querySelector(".tabs")).select(
                nextTab
              );
              updateState();
            });
          });
          document.querySelectorAll(".prev-step").forEach((button) => {
            button.addEventListener("click", function () {
              const prevTab = this.getAttribute("data-prev");
              M.Tabs.getInstance(document.querySelector(".tabs")).select(
                prevTab
              );
            });
          });

          // Add Premise Button
          document
            .getElementById("add-premise")
            .addEventListener("click", addNewPremise);

          // Update Conclusion on Outcome changes
          document
            .getElementById("source-outcome")
            .addEventListener("input", updateConclusion);
          document
            .getElementById("target-desired-outcome")
            .addEventListener("input", updateConclusion);

          // Update Evaluation Company Names on Name changes
          document
            .getElementById("source-name")
            .addEventListener("input", () => {
              if (
                M.Tabs.getInstance(document.querySelector(".tabs")).index === 3
              )
                updateEvaluationCompanyNames();
            });
          document
            .getElementById("target-name")
            .addEventListener("input", () => {
              if (
                M.Tabs.getInstance(document.querySelector(".tabs")).index === 3
              )
                updateEvaluationCompanyNames();
            });

          // Reset Button
          document
            .getElementById("reset-btn")
            .addEventListener("click", resetData);

          // Export Buttons
          document
            .getElementById("export-txt")
            .addEventListener("click", exportAsText);
          const pdfButton = document.getElementById("export-pdf");
          if (pdfButton) {
            pdfButton.addEventListener("click", exportAsPDF);
          }
          document
            .getElementById("export-btn")
            .addEventListener("click", exportAsText);

          // Save on change/keyup events (debounced)
          document.querySelectorAll("input, textarea, select").forEach((el) => {
            el.addEventListener("change", saveToLocalStorage);
            el.addEventListener("keyup", debounce(saveToLocalStorage, 2000));
          });

          // Bind initial feature type listeners
          bindFeatureTypeListeners();

          // Attempt to load saved data; if none, open the help modal
          if (!loadFromLocalStorage()) {
            const modalInstance = M.Modal.getInstance(
              document.getElementById("help-modal")
            );
            modalInstance.open();
          }
        });

        // Add "Load Example" button to Help Modal
        const loadExampleBtn = document.createElement("a");
        loadExampleBtn.className = "waves-effect waves-light btn";
        loadExampleBtn.innerHTML =
          '<i class="material-icons left">play_arrow</i>Load Example Data';
        loadExampleBtn.addEventListener("click", function () {
          loadExampleData();
          M.Modal.getInstance(document.getElementById("help-modal")).close();
        });
        document.querySelector(".modal-footer").prepend(loadExampleBtn);
      })();
    </script>
  </body>
</html>
